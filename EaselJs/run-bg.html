<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>EaselJS: Sprite Sheet Example</title>


    <link href="css/test.css" rel="stylesheet" type="text/css"/>
    <script src="js/preloadjs-NEXT.min.js"></script>
    <script src="js/easeljs-NEXT.min.js"></script>


    <script>
        var stage, w, h, loader;
        var sky, grant, ground, hill, hill2;

        function init() {
            stage = new createjs.Stage("test1");
            w = stage.canvas.width;
            h = stage.canvas.height;

            manifest = [
                {src: "spritesheet_grant.png", id: "grant"},
                {src: "sky.png", id: "sky"},
                {src: "ground.png", id: "ground"},
                {src: "hill1.png", id: "hill"},
                {src: "hill2.png", id: "hill2"}
            ];

            loader = new createjs.LoadQueue(false);
            loader.addEventListener("complete", handleComplete);
            loader.loadManifest(manifest, true, "img/");
        }

        function handleComplete() {


            var skyImg = loader.getResult("sky");
            sky = new createjs.Shape();
            sky.graphics.beginBitmapFill(skyImg).drawRect(0, 0, w, h);
            sky.alpha =0.8;


            var groundImg = loader.getResult("ground");
            ground = new createjs.Shape();
            ground.graphics.beginBitmapFill(groundImg).drawRect(0, 0, w + groundImg.width, groundImg.height);
            ground.tileW = groundImg.width;
            ground.y = h - groundImg.height;



            hill = new createjs.Bitmap(loader.getResult("hill"));
            hill.setTransform(Math.random() * w, h - hill.image.height*4  - groundImg.height, 4, 4);
            //下面写法可以
            //var hill1 = loader.getResult("hill");
            //hill.setTransform(Math.random() * w, h - hill1.height*4  - groundImg.height, 4, 4);
            hill.alpha =0.5; //透明度



            hill2 = new createjs.Bitmap(loader.getResult("hill2"));
            hill2.setTransform(Math.random() * w, h - hill2.image.height * 3 - groundImg.height, 3, 3);



            var data={
                framerate:30,//帧率
                images:['img/spritesheet_grant.png'],
                frames:{
                    height:292,
                    width:165,
                    regX:82,
                    regY:0,
                    count:64,
                },
                animations:{
                    run:[0,25,'run',1.5],
                    jump:[26,63,'run'],
                }
            }
            var spriteSheet = new createjs.SpriteSheet(data);

            grant = new createjs.Sprite(spriteSheet, "run");
            grant.y = 35;


            stage.addChild(sky,hill,hill2, ground,grant);

            stage.addEventListener("stagemousedown", handleJumpStart);

            createjs.Ticker.timingMode = createjs.Ticker.RAF;
            createjs.Ticker.addEventListener("tick", tick);
        }

        function handleJumpStart() {
            grant.gotoAndPlay("jump");
        }


        function tick(event) {
            grant.x = grant.x + 3;
            if(grant.x>stage.canvas.width+80){
                grant.x=-85;
            }

            ground.x = (ground.x-1.5 ) % 81;


            hill.x = (hill.x - 0.5);
            if (hill.x + hill.image.width * 4 <= 0) {

                hill.x = w;
            }
            hill2.x = (hill2.x - 0.8);
            if (hill2.x + hill2.image.width * 3 <= 0) {
                hill2.x = w;
            }

            stage.update(event);
        }
    </script>
</head>

<body onload="init();">

<div>
    <canvas id="test1" width="960" height="400"></canvas>
</div>

</body>
</html>
