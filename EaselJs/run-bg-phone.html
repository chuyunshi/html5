<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0,minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>手机端</title>
    <link rel="stylesheet" href="css/test.css"/>
    <script src="js/preloadjs-NEXT.min.js"></script>
    <script src="js/easeljs-0.8.2.min.js"></script>
    <script src="js/zepto.min.js"></script>
</head>
<body onload="init();">

<div>
    <canvas id="test1"></canvas>
</div>
</body>
</html>
<script>
    var stage, w, h, loader;
    var sky, grant, ground, hill, hill2;
    var pageH = $(window).height();
    var pageW = $(window).width();

    function init() {
        stage = new createjs.Stage("test1");
        w = stage.canvas.width = pageW-2;
        h = stage.canvas.height = pageH/3;

        manifest = [
            {src: "spritesheet_grant.png", id: "grant"},
            {src: "sky.png", id: "sky"},
            {src: "ground.png", id: "ground"},
            {src: "hill1.png", id: "hill"},
            {src: "hill2.png", id: "hill2"}
        ];

        loader = new createjs.LoadQueue(false);
        loader.addEventListener("complete", handleComplete);
        loader.loadManifest(manifest, true, "img/");
    }

    function handleComplete() {


        var skyImg = loader.getResult("sky");
        sky = new createjs.Shape();
        sky.graphics.beginBitmapFill(skyImg).drawRect(0, 0, w, h);



        var groundImg = loader.getResult("ground");
        ground = new createjs.Shape();
        ground.graphics.beginBitmapFill(groundImg).drawRect(0, 0, w + 3*w, 0.6*h);
        ground.tileW = groundImg.width;
        ground.y = h - 0.23*h;
        ground.scaleX = 0.00169*w;
        ground.scaleY = 0.003*h;



        hill = new createjs.Bitmap(loader.getResult("hill"));
        hill.setTransform(Math.random() * w, h - 0.52*h, 0.003*w,0.00536*h);
        //下面写法可以
        //var hill1 = loader.getResult("hill");
        //hill.setTransform(Math.random() * w, h - hill1.height*4  - groundImg.height, 4, 4);
        hill.alpha =0.5; //透明度
       // hill.scaleX = 0.003*w
      //  hill.scaleY = 0.00536*h;


        hill2 = new createjs.Bitmap(loader.getResult("hill2"));
        hill2.setTransform(Math.random() * w, h - 0.60*h  , 0.004*w, 0.00738*h);

        //  hill.scaleX = 0.004*w
        //  hill.scaleY = 0.00738*h;

        var data={
            framerate:30,//帧率
            images:['img/spritesheet_grant.png'],
            frames:{
                height:292,
                width:165,
                regX:82,
                regY:0,
                count:64,
            },
            animations:{
                run:[0,25,'run',1.5],
                jump:[26,63,'run'],
            }
        }
        var spriteSheet = new createjs.SpriteSheet(data);

        grant = new createjs.Sprite(spriteSheet, "run");
        grant.y=0.02*h;
        grant.scaleX = 0.0015*w ;
        grant.scaleY = 0.00266*h;


        stage.addChild(sky, hill ,hill2, ground,grant);

        stage.addEventListener("stagemousedown", handleJumpStart);

        createjs.Ticker.timingMode = createjs.Ticker.RAF;
        createjs.Ticker.addEventListener("tick", tick);
    }

    function handleJumpStart() {
        grant.gotoAndPlay("jump");
    }


    function tick(event) {
        grant.x = grant.x + 1.5;
        if(grant.x>stage.canvas.width+80){
            grant.x=-85;
        }

        ground.x = (ground.x-1.5 ) % (81*0.00169*w);


        hill.x = (hill.x - 0.5);
        if (hill.x + hill.image.width * 0.003*w <= 0) {

            hill.x = w;
        }
        hill2.x = (hill2.x - 0.8);
        if (hill2.x + hill2.image.width * 0.004*w <= 0) {
            hill2.x = w;
        }

        stage.update(event);
    }
</script>